<div class="sucursales-container">
    <h1>Gestión de Sucursales</h1>

    @if (!isAdmin) {
    <div class="admin-warning">
        <p>⚠️ Solo los administradores pueden gestionar sucursales</p>
    </div>
    }

    @if (isAdmin) {
    <button (click)="showForm = !showForm" class="btn-primary">
        {{ showForm ? 'Cancelar' : 'Agregar Sucursal' }}
    </button>
    }

    <!-- Formulario de nueva sucursal -->
    @if (showForm && isAdmin && !isEditing) {
    <div class="form-container">
        <h3>Nueva Sucursal</h3>
        <form (ngSubmit)="onSubmit()" #sucursalForm="ngForm">
            <div class="form-group">
                <input type="text" [(ngModel)]="newSucursal.nombreSucursal" name="nombreSucursal"
                    placeholder="Nombre de la Sucursal" required>
            </div>
            <div class="form-group">
                <input type="text" [(ngModel)]="newSucursal.ciudad" name="ciudad" placeholder="Ciudad" required>
            </div>
            <div class="form-group">
                <input type="text" [(ngModel)]="newSucursal.direccion" name="direccion" placeholder="Dirección"
                    required>
            </div>
            <div class="form-group">
                <input type="text" [(ngModel)]="newSucursal.telefono" name="telefono" placeholder="Teléfono">
            </div>
            <div class="form-actions">
                <button type="submit" [disabled]="!sucursalForm.valid || isLoading" class="btn-primary">
                    {{ isLoading ? 'Creando...' : 'Guardar' }}
                </button>
                <button type="button" (click)="cancelForm()" class="btn-secondary">Cancelar</button>
            </div>
        </form>
    </div>
    }

    <!-- Modal de edición centrado -->
    @if (isEditing && isAdmin) {
    <div class="modal-backdrop fade show"></div>
    <div class="modal fade show d-block" tabindex="-1" role="dialog" style="background-color: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editar Sucursal</h5>
                    <button type="button" class="btn-close" (click)="cancelForm()" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form (ngSubmit)="onUpdate()" #editSucursalForm="ngForm">
                        <div class="form-group">
                            <label>Nombre de la Sucursal *</label>
                            <input type="text" class="form-control" [(ngModel)]="editSucursal.nombreSucursal"
                                name="editNombreSucursal" placeholder="Nombre de la Sucursal" required>
                        </div>
                        <div class="form-group">
                            <label>Ciudad *</label>
                            <input type="text" class="form-control" [(ngModel)]="editSucursal.ciudad" name="editCiudad"
                                placeholder="Ciudad" required>
                        </div>
                        <div class="form-group">
                            <label>Dirección *</label>
                            <input type="text" class="form-control" [(ngModel)]="editSucursal.direccion"
                                name="editDireccion" placeholder="Dirección" required>
                        </div>
                        <div class="form-group">
                            <label>Teléfono</label>
                            <input type="text" class="form-control" [(ngModel)]="editSucursal.telefono"
                                name="editTelefono" placeholder="Teléfono">
                        </div>
                        <div class="form-actions">
                            <button type="submit" [disabled]="!editSucursalForm.valid || isLoading" class="btn-primary">
                                {{ isLoading ? 'Actualizando...' : 'Actualizar Sucursal' }}
                            </button>
                            <button type="button" (click)="cancelForm()" class="btn-secondary">Cancelar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    }

    <div class="search-container">
        <input type="text" [(ngModel)]="searchId" placeholder="Buscar por ID">
        <button (click)="searchSucursal()" class="btn-primary">Buscar</button>
        <button (click)="loadSucursales()" class="btn-secondary">Mostrar Todos</button>
    </div>

    @if (isLoading) {
    <div class="loading">Cargando sucursales...</div>
    }

    @if (!isLoading && sucursales.length > 0) {
    <table>
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Ciudad</th>
                <th>Dirección</th>
                <th>Teléfono</th>
                @if (isAdmin) {
                <th>Acciones</th>
                }
            </tr>
        </thead>
        <tbody>
            @for (sucursal of sucursales; track sucursal.idSucursal) {
            <tr>
                <td>{{ sucursal.nombreSucursal }}</td>
                <td>{{ sucursal.ciudad }}</td>
                <td>{{ sucursal.direccion }}</td>
                <td>{{ sucursal.telefono }}</td>
                @if (isAdmin) {
                <td>
                    <button (click)="editarSucursal(sucursal)" class="btn-edit">Editar</button>
                    <button (click)="deleteSucursal(sucursal.idSucursal)" class="btn-delete">Eliminar</button>
                </td>
                }
            </tr>
            }
        </tbody>
    </table>
    }

    @if (!isLoading && sucursales.length === 0) {
    <div class="no-data">
        No se encontraron sucursales.
    </div>
    }
</div>